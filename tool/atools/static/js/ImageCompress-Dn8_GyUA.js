import{l as r,y as t,q as k,J as I,F as J,D as L,L as W,H as _,I as p,K as Z,b as B,c as C,r as X,v as d,G as z,C as b,A as m,M as f,B as A,N as Y}from"./@vue-CpAqE2Pn.js";import{_ as ee}from"./FileUploader-DU1r4fqN.js";import{F as R}from"./file-saver-D_h_-nX0.js";import{J as te}from"./jszip-DXViFxuE.js";import{_ as se}from"./plugin-vueexport-helper-DlAUqK2U.js";const le={class:"min-h-screen bg-slate-50 relative overflow-hidden font-sans selection:bg-teal-100"},oe={class:"relative z-10 max-w-5xl mx-auto px-6 py-12"},ae={class:"flex flex-col items-center mb-10 text-center"},ne={class:"flex flex-col items-center gap-6 mb-8"},ie={class:"p-1.5 bg-slate-200/60 backdrop-blur rounded-2xl inline-flex shadow-inner"},re=["onClick"],de={key:0,class:"w-1.5 h-1.5 rounded-full bg-teal-500"},ce={key:0,class:"w-full max-w-3xl bg-white/90 backdrop-blur-xl rounded-2xl shadow-xl border border-teal-100 p-6 md:p-8"},ue={class:"grid md:grid-cols-2 gap-8 relative"},pe={class:"flex items-center gap-3 cursor-pointer group"},me={class:"relative flex items-center justify-center"},xe={class:"pl-8 space-y-5"},be={class:"flex justify-between mb-2"},ge={class:"text-sm font-mono font-bold text-teal-600 bg-teal-50 px-2 rounded"},fe=["disabled"],ve=["disabled"],ye={class:"flex items-center gap-3 cursor-pointer group"},he={class:"relative flex items-center justify-center"},we={class:"pl-8 space-y-5"},ke={class:"relative"},_e=["disabled"],Be={class:"flex gap-4"},Ce={class:"flex items-center gap-2 cursor-pointer"},ze=["disabled"],qe={class:"flex items-center gap-2 cursor-pointer"},je=["disabled"],Fe={class:"bg-white/70 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/50 overflow-hidden min-h-[400px] flex flex-col"},Me={key:0,class:"flex-1 flex flex-col items-center justify-center p-12"},Se={key:1,class:"flex flex-col h-full"},Ue={class:"p-4 border-b border-slate-200/60 bg-white/40 flex justify-between items-center"},Ve={class:"flex-1 overflow-y-auto max-h-[500px] bg-slate-50/30 p-4 space-y-3"},Ie={class:"flex items-center gap-4 overflow-hidden"},Je={class:"w-12 h-12 bg-slate-100 rounded-lg overflow-hidden shrink-0 border border-slate-200"},Le=["src"],Ae={class:"min-w-0"},Re={class:"text-sm font-bold text-slate-800 truncate max-w-[150px] md:max-w-[300px]"},Pe={class:"text-xs text-slate-400 flex gap-2"},Ke={key:0,class:"text-teal-600 font-bold"},$e={class:"flex items-center gap-4"},Ee={key:0,class:"text-blue-500"},Ne={key:1,class:"text-right"},De={class:"block text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full mb-1"},Qe={class:"flex gap-2"},Ge=["onClick"],Te=["onClick"],He={class:"p-4 bg-white border-t border-slate-100 flex justify-between items-center"},Oe={class:"hidden md:block text-sm text-slate-500"},We={class:"font-bold text-emerald-600"},Ze=["disabled"],Xe={__name:"ImageCompress",setup(Ye){const P=[{key:"small",label:"缩小优先"},{key:"balance",label:"推荐模式"},{key:"clear",label:"清晰优先"},{key:"custom",label:"自定义"}],x=B("balance"),q=B(null),i=B([]),o=X({method:"quality",quality:90,scale:1,targetKB:100,forceJpeg:!1}),j=C(()=>i.value.some(l=>l.status==="processing")),K=C(()=>i.value.some(l=>l.status==="done")),$=C(()=>i.value.reduce((l,e)=>e.status==="done"&&e.compressedBlob?l+(e.file.size-e.compressedBlob.size):l,0)),v=l=>{if(l===0)return"0 B";const e=1024,a=["B","KB","MB"],s=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,s)).toFixed(2))+" "+a[s]},E=l=>{if(!l.compressedBlob)return 0;const e=(l.file.size-l.compressedBlob.size)/l.file.size*100;return Math.max(0,e.toFixed(1))},N=l=>{x.value=l,l!=="custom"&&M()},F=l=>{const e=l.map(a=>({id:Math.random().toString(36).substr(2,9),file:a,preview:URL.createObjectURL(a),status:"pending",compressedBlob:null}));i.value.push(...e),S()},D=()=>q.value.click(),Q=l=>{URL.revokeObjectURL(i.value[l].preview),i.value.splice(l,1)},G=()=>{i.value.forEach(l=>URL.revokeObjectURL(l.preview)),i.value=[]},M=()=>{i.value.forEach(l=>l.status="pending"),S()},y=(l,e,a,s=1)=>new Promise(c=>{const n=document.createElement("canvas"),u=n.getContext("2d");n.width=l.width*s,n.height=l.height*s,u.fillStyle="#FFFFFF",u.fillRect(0,0,n.width,n.height),u.drawImage(l,0,0,n.width,n.height),n.toBlob(g=>c(g),e,a)}),T=async(l,e,a,s)=>{const c=a*1024,n=s||e==="image/png"?"image/jpeg":e;let u=.01,g=1,U=null;for(let V=0;V<6;V++){const h=(u+g)/2,w=await y(l,n,h,1);if(!w)break;U=w,w.size>c?g=h:u=h}return U},S=async()=>{for(const l of i.value)if(l.status==="pending"){l.status="processing",await new Promise(s=>requestAnimationFrame(s));const e=new Image;if(e.src=l.preview,await new Promise(s=>{e.onload=s,e.onerror=()=>{l.status="error",s()}}),l.status==="error")continue;let a=null;if(x.value==="custom")if(o.method==="quality"){const s=o.quality/100,c=o.scale,n=l.file.type==="image/png"?"image/jpeg":l.file.type;a=await y(e,n,s,c)}else a=await T(e,l.file.type,o.targetKB,o.forceJpeg);else{const s={small:{q:.5,s:1},balance:{q:.75,s:1},clear:{q:.9,s:1}},{q:c,s:n}=s[x.value],u=l.file.type==="image/png"?"image/jpeg":l.file.type;a=await y(e,u,c,n)}a?(l.compressedBlob=a,l.status="done"):l.status="error"}},H=l=>{R.saveAs(l.compressedBlob,`min_${l.file.name}`)},O=async()=>{const l=new te,e=l.folder("compressed_images");i.value.forEach(s=>{s.status==="done"&&s.compressedBlob&&e.file(`min_${s.file.name}`,s.compressedBlob)});const a=await l.generateAsync({type:"blob"});R.saveAs(a,`images_archive_${Date.now()}.zip`)};return(l,e)=>{const a=Z("RouterLink");return d(),r("div",le,[e[31]||(e[31]=t("div",{class:"absolute inset-0 z-0 opacity-[0.4]",style:{"background-image":"radial-gradient(#cbd5e1 1px, transparent 1px)","background-size":"32px 32px"}},null,-1)),e[32]||(e[32]=t("div",{class:"absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-teal-300 rounded-full mix-blend-multiply filter blur-[128px] opacity-40 animate-blob"},null,-1)),e[33]||(e[33]=t("div",{class:"absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-sky-300 rounded-full mix-blend-multiply filter blur-[128px] opacity-40 animate-blob animation-delay-2000"},null,-1)),t("div",oe,[t("div",ae,[k(a,{to:"/",class:"text-sm font-medium text-slate-500 hover:text-teal-600 mb-4 inline-flex items-center gap-1 transition-colors"},{default:I(()=>[...e[8]||(e[8]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"m15 18-6-6 6-6"})],-1),_(" 返回首页 ",-1)])]),_:1}),e[9]||(e[9]=t("h1",{class:"text-3xl md:text-4xl font-extrabold text-slate-900 mb-3"},[t("span",{class:"text-transparent bg-clip-text bg-gradient-to-r from-teal-500 to-emerald-600"},"图片智能压缩")],-1))]),t("div",ne,[t("div",ie,[(d(),r(J,null,L(P,s=>t("button",{key:s.key,onClick:c=>N(s.key),class:z(["px-6 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 flex items-center gap-2",x.value===s.key?"bg-white text-teal-700 shadow-lg shadow-teal-900/5 scale-100 ring-1 ring-black/5":"text-slate-500 hover:text-slate-700 hover:bg-white/50"])},[t("span",null,p(s.label),1),x.value===s.key?(d(),r("span",de)):b("",!0)],10,re)),64))]),k(W,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"transform -translate-y-4 opacity-0","enter-to-class":"transform translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"transform translate-y-0 opacity-100","leave-to-class":"transform -translate-y-4 opacity-0"},{default:I(()=>[x.value==="custom"?(d(),r("div",ce,[t("div",ue,[e[24]||(e[24]=t("div",{class:"hidden md:block absolute left-1/2 top-4 bottom-4 w-px bg-slate-200"},null,-1)),t("div",{class:z(["space-y-6",{"opacity-50 grayscale":o.method!=="quality"}])},[t("label",pe,[t("div",me,[m(t("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=s=>o.method=s),value:"quality",class:"peer appearance-none w-5 h-5 border-2 border-slate-300 rounded-full checked:border-teal-500 checked:bg-teal-500 transition-all"},null,512),[[f,o.method]]),e[10]||(e[10]=t("div",{class:"absolute w-2 h-2 bg-white rounded-full opacity-0 peer-checked:opacity-100 transition-opacity"},null,-1))]),e[11]||(e[11]=t("span",{class:"font-bold text-slate-800 text-lg group-hover:text-teal-600 transition-colors"},"指定清晰度压缩",-1))]),t("div",xe,[t("div",null,[t("div",be,[e[12]||(e[12]=t("span",{class:"text-sm text-slate-600"},"清晰度",-1)),t("span",ge,p(o.quality)+"%",1)]),m(t("input",{type:"range","onUpdate:modelValue":e[1]||(e[1]=s=>o.quality=s),min:"10",max:"100",step:"5",disabled:o.method!=="quality",class:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-teal-500 disabled:cursor-not-allowed"},null,8,fe),[[A,o.quality,void 0,{number:!0}]])]),t("div",null,[e[14]||(e[14]=t("span",{class:"text-sm text-slate-600 block mb-2"},"分辨率缩放",-1)),m(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.scale=s),disabled:o.method!=="quality",class:"w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-teal-500 outline-none disabled:bg-slate-100"},[...e[13]||(e[13]=[t("option",{value:1}," 保持原分辨率 ",-1),t("option",{value:.75}," 75% (缩小尺寸) ",-1),t("option",{value:.5}," 50% (缩小尺寸) ",-1)])],8,ve),[[Y,o.scale,void 0,{number:!0}]])])])],2),t("div",{class:z(["space-y-6",{"opacity-50 grayscale":o.method!=="size"}])},[t("label",ye,[t("div",he,[m(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=s=>o.method=s),value:"size",class:"peer appearance-none w-5 h-5 border-2 border-slate-300 rounded-full checked:border-sky-500 checked:bg-sky-500 transition-all"},null,512),[[f,o.method]]),e[15]||(e[15]=t("div",{class:"absolute w-2 h-2 bg-white rounded-full opacity-0 peer-checked:opacity-100 transition-opacity"},null,-1))]),e[16]||(e[16]=t("span",{class:"font-bold text-slate-800 text-lg group-hover:text-sky-600 transition-colors"},"指定大小压缩",-1)),e[17]||(e[17]=t("span",{class:"text-xs bg-sky-100 text-sky-700 px-2 py-0.5 rounded ml-auto"},"Beta",-1))]),t("div",we,[t("div",null,[e[19]||(e[19]=t("span",{class:"text-sm text-slate-600 block mb-2"},"期望大小 (KB)",-1)),t("div",ke,[m(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=s=>o.targetKB=s),min:"10",disabled:o.method!=="size",class:"w-full bg-white border border-slate-300 rounded-lg pl-4 pr-12 py-2 text-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-200 outline-none transition disabled:bg-slate-100"},null,8,_e),[[A,o.targetKB,void 0,{number:!0}]]),e[18]||(e[18]=t("span",{class:"absolute right-4 top-2 text-sm text-slate-400"},"KB",-1))]),e[20]||(e[20]=t("p",{class:"text-xs text-slate-400 mt-2"}," 注：我们会尝试逼近此数值，但无法保证 100% 精确。 ",-1))]),t("div",null,[e[23]||(e[23]=t("span",{class:"text-sm text-slate-600 block mb-2"},"输出格式",-1)),t("div",Be,[t("label",Ce,[m(t("input",{type:"radio",value:!1,"onUpdate:modelValue":e[5]||(e[5]=s=>o.forceJpeg=s),disabled:o.method!=="size",class:"text-sky-500 focus:ring-sky-500"},null,8,ze),[[f,o.forceJpeg]]),e[21]||(e[21]=t("span",{class:"text-sm text-slate-700"},"原格式",-1))]),t("label",qe,[m(t("input",{type:"radio",value:!0,"onUpdate:modelValue":e[6]||(e[6]=s=>o.forceJpeg=s),disabled:o.method!=="size",class:"text-sky-500 focus:ring-sky-500"},null,8,je),[[f,o.forceJpeg]]),e[22]||(e[22]=t("span",{class:"text-sm text-slate-700"},"转为 JPG",-1))])])])])],2),t("div",{class:"md:col-span-2 pt-6 border-t border-slate-100 flex justify-end"},[t("button",{onClick:M,class:"px-6 py-2 bg-slate-900 text-white text-sm font-bold rounded-lg hover:bg-slate-700 transition"}," 应用并重新压缩 ")])])])):b("",!0)]),_:1})]),t("div",Fe,[i.value.length===0?(d(),r("div",Me,[k(ee,{accept:"image/*",multiple:!0,hint:"支持 JPG, PNG, WebP",onFilesSelected:F})])):(d(),r("div",Se,[t("div",Ue,[t("div",{class:"inline-flex items-center gap-2 text-sm text-teal-700 font-medium cursor-pointer hover:bg-teal-50 px-3 py-1.5 rounded-lg transition",onClick:D},[e[25]||(e[25]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)),e[26]||(e[26]=_(" 添加图片 ",-1)),t("input",{type:"file",ref_key:"addInput",ref:q,multiple:"",accept:"image/*",class:"hidden",onChange:e[7]||(e[7]=s=>F([...s.target.files]))},null,544)]),t("button",{onClick:G,class:"text-xs text-red-400 hover:text-red-600 px-3"}," 清空列表 ")]),t("div",Ve,[(d(!0),r(J,null,L(i.value,(s,c)=>(d(),r("div",{key:s.id,class:"bg-white border border-slate-100 rounded-xl p-4 flex items-center justify-between shadow-sm hover:shadow-md transition-all"},[t("div",Ie,[t("div",Je,[t("img",{src:s.preview,class:"w-full h-full object-cover"},null,8,Le)]),t("div",Ae,[t("div",Re,p(s.file.name),1),t("div",Pe,[t("span",null,"原始: "+p(v(s.file.size)),1),s.status==="done"&&s.compressedBlob?(d(),r("span",Ke," → "+p(v(s.compressedBlob.size)),1)):b("",!0)])])]),t("div",$e,[s.status==="processing"?(d(),r("div",Ee,[...e[27]||(e[27]=[t("svg",{class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):s.status==="done"?(d(),r("div",Ne,[t("span",De," -"+p(E(s))+"% ",1)])):b("",!0),t("div",Qe,[s.status==="done"?(d(),r("button",{key:0,onClick:n=>H(s),class:"p-2 text-slate-400 hover:text-teal-600 hover:bg-teal-50 rounded-lg transition"},[...e[28]||(e[28]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,Ge)):b("",!0),t("button",{onClick:n=>Q(c),class:"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition"},[...e[29]||(e[29]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Te)])])]))),128))]),t("div",He,[t("div",Oe,[e[30]||(e[30]=_(" 节省空间: ",-1)),t("span",We,p(v($.value)),1)]),t("button",{onClick:O,disabled:j.value||!K.value,class:"w-full md:w-auto px-8 py-3 bg-gradient-to-r from-teal-600 to-emerald-600 hover:from-teal-700 hover:to-emerald-700 text-white font-bold rounded-xl shadow-lg shadow-teal-500/30 transition-all disabled:opacity-50 disabled:shadow-none"},p(j.value?"正在压缩...":"打包下载全部"),9,Ze)])]))])])])}}},at=se(Xe,[["__scopeId","data-v-8e540ec1"]]);export{at as default};
