function N(e,t){if(e==null)return;let r=e;for(let i=0;i<t.length;i++){if(r===void 0||r[t[i]]===void 0)return;if(r===null||r[t[i]]===null)return null;r=r[t[i]]}return r}function o(e,t,r){if(r.length===0)return t;const i=r[0];return r.length>1&&(t=o(typeof e!="object"||e===null||!Object.prototype.hasOwnProperty.call(e,i)?Number.isInteger(Number(r[1]))?[]:{}:e[i],t,Array.prototype.slice.call(r,1))),Number.isInteger(Number(i))&&Array.isArray(e)?e.slice()[i]:Object.assign({},e,{[i]:t})}function A(e,t){if(e==null||t.length===0)return e;if(t.length===1){if(e==null)return e;if(Number.isInteger(t[0])&&Array.isArray(e))return Array.prototype.slice.call(e,0).splice(t[0],1);const r={};for(const i in e)r[i]=e[i];return delete r[t[0]],r}if(e[t[0]]==null){if(Number.isInteger(t[0])&&Array.isArray(e))return Array.prototype.concat.call([],e);const r={};for(const i in e)r[i]=e[i];return r}return o(e,A(e[t[0]],Array.prototype.slice.call(t,1)),[t[0]])}function S(e,t){return t.map(r=>r.split(".")).map(r=>[r,N(e,r)]).filter(r=>r[1]!==void 0).reduce((r,i)=>o(r,i[1],i[0]),{})}function $(e,t){return t.map(r=>r.split(".")).reduce((r,i)=>A(r,i),e)}function m(e,{storage:t,serializer:r,key:i,debug:n,pick:l,omit:c,beforeHydrate:s,afterHydrate:u},a,d=!0){try{d&&(s==null||s(a));const f=t.getItem(i);if(f){const g=r.deserialize(f),y=l?S(g,l):g,z=c?$(y,c):y;e.$patch(z)}d&&(u==null||u(a))}catch(f){n&&console.error("[pinia-plugin-persistedstate]",f)}}function p(e,{storage:t,serializer:r,key:i,debug:n,pick:l,omit:c}){try{const s=l?S(e,l):e,u=c?$(s,c):s,a=r.serialize(u);t.setItem(i,a)}catch(s){n&&console.error("[pinia-plugin-persistedstate]",s)}}function v(e,t){return typeof e=="function"?e(t):typeof e=="string"?e:t}function O(e,t,r){const{pinia:i,store:n,options:{persist:l=r}}=e;if(!l)return;// v8 ignore if -- @preserve
if(!(n.$id in i.state.value)){const s=i._s.get(n.$id.replace("__hot:",""));s&&Promise.resolve().then(()=>s.$persist());return}const c=(Array.isArray(l)?l:l===!0?[{}]:[l]).map(t);n.$hydrate=({runHooks:s=!0}={})=>{c.forEach(u=>{m(n,u,e,s)})},n.$persist=()=>{c.forEach(s=>{p(n.$state,s)})},c.forEach(s=>{m(n,s,e),n.$subscribe((u,a)=>p(a,s),{detached:!0})})}function P(e={}){return function(t){O(t,r=>{const i=v(r.key,t.store.$id);return{key:(e.key?e.key:n=>n)(i),debug:r.debug??e.debug??!1,serializer:r.serializer??e.serializer??{serialize:n=>JSON.stringify(n),deserialize:n=>JSON.parse(n)},storage:r.storage??e.storage??window.localStorage,beforeHydrate:r.beforeHydrate??e.beforeHydrate,afterHydrate:r.afterHydrate??e.afterHydrate,pick:r.pick,omit:r.omit}},e.auto??!1)}}var I=P();export{I as s};
