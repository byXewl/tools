import{_ as ne}from"./FileUploader-DU1r4fqN.js";import{F as M}from"./file-saver-D_h_-nX0.js";import{J as K}from"./jszip-DXViFxuE.js";import{Q as re}from"./qrcode-D5C6Tm8L.js";import{_ as ie}from"./plugin-vueexport-helper-DlAUqK2U.js";import{o as ce,l as i,y as t,q as N,J as de,F as ue,D as pe,H as P,I as x,C,z as ve,b as v,K as me,c as I,v as c}from"./@vue-CpAqE2Pn.js";import"./dijkstrajs-COg3n3zL.js";const fe={class:"min-h-screen bg-slate-50 relative overflow-hidden font-sans selection:bg-amber-100"},be={class:"relative z-10 max-w-5xl mx-auto px-6 py-12"},xe={class:"flex flex-col items-center mb-10 text-center"},he={class:"grid lg:grid-cols-12 gap-8"},we={class:"lg:col-span-7 space-y-6"},ge={class:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/50 p-6 md:p-8 min-h-[500px]"},ye={key:0},ke={key:0,class:"mt-6 space-y-4"},_e={class:"flex items-center gap-3 flex-1"},Se={class:"min-w-0"},Ce={class:"font-medium text-slate-800 truncate"},Ae={class:"text-xs text-slate-500"},Be=["onClick"],Fe={key:0,class:"text-xs text-center text-slate-500"},Ee={key:0,class:"text-orange-500"},ze={class:"pt-4 border-t border-slate-200"},Re=["disabled"],Ue={key:0,class:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"},Le={key:0,class:"text-xs text-center text-slate-500 mt-2"},Ge={key:1,class:"flex flex-col items-center justify-center h-full text-slate-400 py-12"},Me={key:1,class:"text-center space-y-6"},Pe={class:"p-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl border border-amber-200"},Te={class:"text-sm text-amber-700 mb-3 font-semibold"},De=["value"],$e={key:2,class:"text-center py-12 space-y-4"},je={class:"text-lg font-medium text-slate-700"},Ve={class:"text-sm text-slate-500"},Ke={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Ne={class:"bg-white rounded-2xl p-6 max-w-sm w-full mx-4 shadow-2xl"},O=500*1024*1024,Ie={__name:"SecretSend",setup(Oe){const n=v([]),h=v(""),g=v(!1),w=v(0),d=v(""),A=v(""),y=v(!1),k=v(""),T=v(""),E=v(!1),z=I(()=>n.value.reduce((a,e)=>a+e.size,0)),H=I(()=>A.value==="gofile"?"GoFile 通道 (高速/大文件支持)":A.value==="fileio"?"File.io 通道 (阅后即焚)":"加密分享链接"),Q=a=>{n.value=Array.from(a)},q=a=>{n.value.splice(a,1)},B=a=>{if(!a)return"0 B";const e=1024,s=["B","KB","MB","GB"],o=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,o)).toFixed(2))+" "+s[o]},J=async()=>crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),W=async(a,e)=>{const s=crypto.getRandomValues(new Uint8Array(12)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},e,a);return{encrypted:new Uint8Array(o),iv:s}},X=async(a,e,s)=>await crypto.subtle.decrypt({name:"AES-GCM",iv:s},e,a),Y=async(a,e)=>{var _;d.value="正在寻找最佳服务器 (GoFile)...";const s=await fetch("https://api.gofile.io/servers");if(!s.ok)throw new Error("GoFile 服务器连接失败");const o=await s.json();if(o.status!=="ok"||!((_=o.data.servers)!=null&&_.length))throw new Error("无可用 GoFile 服务器");const r=o.data.servers[0].name,u=`https://${r}.gofile.io/contents/uploadfile`;d.value=`正在上传至 ${r}...`;const l=new FormData;l.append("file",a,e);const b=await(await fetch(u,{method:"POST",body:l})).json();if(b.status==="ok")return b.data.downloadPage;throw new Error("GoFile 上传错误")},Z=async(a,e)=>{d.value="尝试备用通道 (File.io via Proxy)...";const s=new FormData;s.append("file",a,e);const u=await fetch("https://corsproxy.io/?"+encodeURIComponent("https://file.io/?expires=1w"),{method:"POST",body:s});if(!u.ok)throw new Error(`Proxy Error: ${u.status}`);const l=await u.json();if(l.success)return l.link;throw new Error(l.message||"File.io 上传失败")},ee=async()=>{if(n.value.length&&!(z.value>O&&!confirm(`文件较大 (${B(z.value)})，浏览器加密可能会导致页面短暂卡顿。是否继续？`))){g.value=!0,w.value=0,d.value="正在生成密钥...";try{const a=await J(),e=await crypto.subtle.exportKey("raw",a),s=btoa(String.fromCharCode(...new Uint8Array(e)));w.value=20,d.value="正在读取文件...";let o,r="";if(n.value.length===1)o=await n.value[0].arrayBuffer(),r=n.value[0].name+".enc";else{d.value="正在压缩打包...";const f=new K;n.value.forEach(S=>f.file(S.name,S)),o=await(await f.generateAsync({type:"blob"})).arrayBuffer(),r="secure_files.zip.enc"}w.value=50,d.value="正在进行 AES-256 加密...";const{encrypted:u,iv:l}=await W(new Uint8Array(o),a),F=new Blob([l,u],{type:"application/octet-stream"});w.value=70;let b="";try{A.value="gofile",b=await Y(F,r)}catch(f){console.warn("GoFile failed, trying fallback:",f);try{A.value="fileio",b=await Z(F,r)}catch{throw new Error("所有通道均繁忙，请稍后再试。")}}w.value=100,d.value="完成！";const _=n.value.map(f=>f.name).join("|"),m=new URLSearchParams;m.set("link",b),m.set("key",s),m.set("p",A.value),m.set("names",_),h.value=`${location.origin}${location.pathname}#${m.toString()}`}catch(a){console.error(a),alert("错误: "+a.message),d.value="操作失败"}finally{g.value=!1}}},D=async()=>{try{await navigator.clipboard.writeText(h.value),alert("链接已复制！")}catch{alert("复制失败，请手动选择复制")}},te=()=>{E.value=!0,setTimeout(()=>{const a=document.getElementById("qrcode");a&&re.toCanvas(a,h.value,{width:200,margin:2})},50)},ae=()=>{n.value=[],h.value="",E.value=!1,w.value=0,history.replaceState(null,"",location.pathname)};return ce(async()=>{if(!location.hash)return;const a=location.hash.substring(1).replace(/^\?/,""),e=new URLSearchParams(a),s=e.get("link"),o=e.get("key"),r=e.get("names"),u=e.get("p");if(s&&o){y.value=!0,k.value="正在建立安全连接...";try{const l=decodeURIComponent(r||"file").split("|"),F=Uint8Array.from(atob(o),p=>p.charCodeAt(0)),b=await crypto.subtle.importKey("raw",F,"AES-GCM",!0,["decrypt"]);k.value="正在下载加密数据...";const _=s;u==="fileio"||s.includes("file.io");const m=await fetch(_,{mode:"cors"});if(!m.ok)throw new Error("文件链接已失效或被删除");const f=+m.headers.get("Content-Length"),U=m.body.getReader();let S=0;const $=[];for(;;){const{done:p,value:R}=await U.read();if(p)break;$.push(R),S+=R.length,f&&(T.value=`已下载 ${B(S)} / ${B(f)}`)}const L=new Uint8Array(S);let j=0;for(const p of $)L.set(p,j),j+=p.length;k.value="正在解密数据...";const se=L.slice(0,12),oe=L.slice(12),G=await X(oe,b,se);if(k.value="处理完成",l.length===1&&!l[0].endsWith(".zip"))M.saveAs(new Blob([G]),l[0]);else{k.value="正在解压...";try{const p=new K;await p.loadAsync(G);for(const[R,V]of Object.entries(p.files))if(!V.dir){const le=await V.async("blob");M.saveAs(le,R)}}catch{M.saveAs(new Blob([G]),"decrypted_files.zip")}}setTimeout(()=>{alert("下载成功！"),y.value=!1},1e3)}catch(l){console.error(l),alert("下载失败: "+l.message),y.value=!1}}}),(a,e)=>{const s=me("RouterLink");return c(),i("div",fe,[e[11]||(e[11]=t("div",{class:"absolute inset-0 z-0 opacity-40",style:{"background-image":"radial-gradient(#94a3b8 1px, transparent 1px)","background-size":"32px 32px"}},null,-1)),e[12]||(e[12]=t("div",{class:"absolute top-0 left-[-10%] w-[600px] h-[600px] bg-amber-400 rounded-full mix-blend-multiply filter blur-[140px] opacity-40 animate-blob"},null,-1)),e[13]||(e[13]=t("div",{class:"absolute bottom-[-15%] right-[-10%] w-[500px] h-[500px] bg-orange-400 rounded-full mix-blend-multiply filter blur-[130px] opacity-40 animate-blob animation-delay-2000"},null,-1)),t("div",be,[t("div",xe,[N(s,{to:"/",class:"text-sm font-medium text-slate-500 hover:text-amber-600 mb-4 inline-flex items-center gap-1 transition-colors"},{default:de(()=>[...e[1]||(e[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"m15 18-6-6 6-6"})],-1),P(" 返回首页 ",-1)])]),_:1}),e[2]||(e[2]=t("h1",{class:"text-3xl md:text-4xl font-extrabold text-slate-900 mb-3"},[t("span",{class:"text-transparent bg-clip-text bg-gradient-to-r from-amber-600 to-orange-600"},"私密瞬传")],-1)),e[3]||(e[3]=t("p",{class:"text-slate-600 max-w-2xl"}," 端到端 AES-256 加密 · 纯前端加密 · 阅后即焚 ",-1))]),t("div",he,[t("div",we,[t("div",ge,[!h.value&&!y.value?(c(),i("div",ye,[N(ne,{accept:"*/*",multiple:"",hint:"点击或拖拽文件到此处",onFilesSelected:Q}),n.value.length?(c(),i("div",ke,[(c(!0),i(ue,null,pe(n.value,(o,r)=>(c(),i("div",{key:r,class:"flex items-center justify-between p-4 bg-amber-50/70 rounded-xl border border-amber-200"},[t("div",_e,[e[4]||(e[4]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"text-amber-600"},[t("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),t("polyline",{points:"14 2 14 8 20 8"})],-1)),t("div",Se,[t("p",Ce,x(o.name),1),t("p",Ae,x(B(o.size)),1)])]),t("button",{onClick:u=>q(r),class:"text-red-500 hover:text-red-700 transition-colors p-1 rounded"},[...e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6 6 18M6 6l12 12"})],-1)])],8,Be)]))),128)),n.value.length>0?(c(),i("p",Fe,[P(" 总大小: "+x(B(z.value))+" ",1),z.value>O?(c(),i("span",Ee,"(注意：大文件加密可能导致页面卡顿)")):C("",!0)])):C("",!0),t("div",ze,[t("button",{onClick:ee,disabled:!n.value.length||g.value,class:"w-full py-4 bg-gradient-to-r from-amber-600 to-orange-600 text-white font-bold rounded-xl shadow-lg hover:shadow-amber-500/50 transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex justify-center items-center gap-2"},[g.value?(c(),i("span",Ue)):C("",!0),P(" "+x(g.value?`处理中... ${w.value}%`:"加密并生成分享链接"),1)],8,Re),g.value?(c(),i("p",Le,x(d.value),1)):C("",!0)])])):(c(),i("div",Ge,[...e[6]||(e[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5",class:"mb-4"},[t("path",{d:"M21.44 11.05l-1-1.55a2 2 0 0 1 0-2.88l1-1.55a2 2 0 0 1 1.5-1.22V3a2 2 0 0 0-2-2h-3.3a2 2 0 0 1-1.5-1.22l-1-1.55a2 2 0 0 1-2.88 0l-1 1.55a2 2 0 0 1-1.5 1.22H3a2 2 0 0 0-2 2v1.3a2 2 0 0 1 1.22 1.5l1.55 1a2 2 0 0 1 0 2.88l-1.55 1a2 2 0 0 1-1.22 1.5V21a2 2 0 0 0 2 2h3.3a2 2 0 0 1 1.5 1.22l1 1.55a2 2 0 0 1 2.88 0l1-1.55a2 2 0 0 1 1.5-1.22H21a2 2 0 0 0 2-2v-1.3a2 2 0 0 1-1.22-1.5l-1.55-1a2 2 0 0 1 0-2.88z"}),t("circle",{cx:"12",cy:"12",r:"3"})],-1),t("p",null,"选择文件开始分享",-1)])]))])):h.value&&!y.value?(c(),i("div",Me,[t("div",Pe,[t("p",Te,x(H.value),1),t("input",{value:h.value,readonly:"",class:"w-full px-4 py-3 bg-white/70 rounded-xl font-mono text-sm text-amber-800 cursor-pointer select-all focus:outline-none focus:ring-2 focus:ring-amber-500",onClick:D},null,8,De),t("div",{class:"flex gap-2 mt-3"},[t("button",{onClick:D,class:"flex-1 py-2 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors"}," 复制链接 "),t("button",{onClick:te,class:"px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors"}," 二维码 ")])]),t("button",{onClick:ae,class:"w-full py-3 bg-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-300 transition-colors"}," 再传一份 ")])):y.value?(c(),i("div",$e,[e[7]||(e[7]=t("div",{class:"w-16 h-16 border-4 border-amber-600 border-t-transparent rounded-full animate-spin mx-auto"},null,-1)),t("p",je,x(k.value),1),t("p",Ve,x(T.value),1)])):C("",!0)])]),e[8]||(e[8]=ve('<div class="lg:col-span-5 space-y-6" data-v-fb4978ac><div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/50 p-6 sticky top-8" data-v-fb4978ac><h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2" data-v-fb4978ac><span class="w-1 h-6 bg-amber-500 rounded-full" data-v-fb4978ac></span> 为什么安全？ </h3><ul class="space-y-3 text-sm text-slate-600" data-v-fb4978ac><li class="flex items-start gap-2" data-v-fb4978ac><span class="text-amber-600 mt-0.5" data-v-fb4978ac>✓</span><span data-v-fb4978ac><b data-v-fb4978ac>本地加密</b>：AES-256 加密在您的浏览器内完成，服务器只收到乱码。</span></li><li class="flex items-start gap-2" data-v-fb4978ac><span class="text-amber-600 mt-0.5" data-v-fb4978ac>✓</span><span data-v-fb4978ac><b data-v-fb4978ac>代理也安全</b>：即使经过代理，由于内容已加密且密钥从未发送，中转方无法窥探内容。</span></li><li class="flex items-start gap-2" data-v-fb4978ac><span class="text-amber-600 mt-0.5" data-v-fb4978ac>✓</span><span data-v-fb4978ac><b data-v-fb4978ac>密钥不联网</b>：解密密钥包含在链接哈希(#)中，浏览器不会将其发送给服务器。</span></li></ul></div></div>',1))])]),E.value?(c(),i("div",Ke,[t("div",Ne,[e[9]||(e[9]=t("h3",{class:"text-lg font-bold mb-4 text-center"}," 分享二维码 ",-1)),e[10]||(e[10]=t("div",{class:"flex justify-center mb-4"},[t("canvas",{id:"qrcode"})],-1)),t("button",{onClick:e[0]||(e[0]=o=>E.value=!1),class:"w-full py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors"}," 关闭 ")])])):C("",!0)])}}},Ze=ie(Ie,[["__scopeId","data-v-fb4978ac"]]);export{Ze as default};
