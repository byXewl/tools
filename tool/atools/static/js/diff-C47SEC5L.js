class I{diff(e,t,n={}){let o;typeof n=="function"?(o=n,n={}):"callback"in n&&(o=n.callback);const l=this.castInput(e,n),a=this.castInput(t,n),d=this.removeEmpty(this.tokenize(l,n)),r=this.removeEmpty(this.tokenize(a,n));return this.diffWithOptionsObj(d,r,n,o)}diffWithOptionsObj(e,t,n,o){var l;const a=s=>{if(s=this.postProcess(s,n),o){setTimeout(function(){o(s)},0);return}else return s},d=t.length,r=e.length;let u=1,i=d+r;n.maxEditLength!=null&&(i=Math.min(i,n.maxEditLength));const C=(l=n.timeout)!==null&&l!==void 0?l:1/0,P=Date.now()+C,f=[{oldPos:-1,lastComponent:void 0}];let m=this.extractCommon(f[0],t,e,0,n);if(f[0].oldPos+1>=r&&m+1>=d)return a(this.buildValues(f[0].lastComponent,t,e));let w=-1/0,v=1/0;const L=()=>{for(let s=Math.max(w,-u);s<=Math.min(v,u);s+=2){let h;const p=f[s-1],g=f[s+1];p&&(f[s-1]=void 0);let x=!1;if(g){const E=g.oldPos-s;x=g&&0<=E&&E<d}const D=p&&p.oldPos+1<r;if(!x&&!D){f[s]=void 0;continue}if(!D||x&&p.oldPos<g.oldPos?h=this.addToPath(g,!0,!1,0,n):h=this.addToPath(p,!1,!0,1,n),m=this.extractCommon(h,t,e,s,n),h.oldPos+1>=r&&m+1>=d)return a(this.buildValues(h.lastComponent,t,e))||!0;f[s]=h,h.oldPos+1>=r&&(v=Math.min(v,s-1)),m+1>=d&&(w=Math.max(w,s+1))}u++};if(o)(function s(){setTimeout(function(){if(u>i||Date.now()>P)return o(void 0);L()||s()},0)})();else for(;u<=i&&Date.now()<=P;){const s=L();if(s)return s}}addToPath(e,t,n,o,l){const a=e.lastComponent;return a&&!l.oneChangePerToken&&a.added===t&&a.removed===n?{oldPos:e.oldPos+o,lastComponent:{count:a.count+1,added:t,removed:n,previousComponent:a.previousComponent}}:{oldPos:e.oldPos+o,lastComponent:{count:1,added:t,removed:n,previousComponent:a}}}extractCommon(e,t,n,o,l){const a=t.length,d=n.length;let r=e.oldPos,u=r-o,i=0;for(;u+1<a&&r+1<d&&this.equals(n[r+1],t[u+1],l);)u++,r++,i++,l.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return i&&!l.oneChangePerToken&&(e.lastComponent={count:i,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=r,u}equals(e,t,n){return n.comparator?n.comparator(e,t):e===t||!!n.ignoreCase&&e.toLowerCase()===t.toLowerCase()}removeEmpty(e){const t=[];for(let n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}castInput(e,t){return e}tokenize(e,t){return Array.from(e)}join(e){return e.join("")}postProcess(e,t){return e}get useLongestToken(){return!1}buildValues(e,t,n){const o=[];let l;for(;e;)o.push(e),l=e.previousComponent,delete e.previousComponent,e=l;o.reverse();const a=o.length;let d=0,r=0,u=0;for(;d<a;d++){const i=o[d];if(i.removed)i.value=this.join(n.slice(u,u+i.count)),u+=i.count;else{if(!i.added&&this.useLongestToken){let C=t.slice(r,r+i.count);C=C.map(function(P,f){const m=n[u+f];return m.length>P.length?m:P}),i.value=this.join(C)}else i.value=this.join(t.slice(r,r+i.count));r+=i.count,i.added||(u+=i.count)}}return o}}class T extends I{}const j=new T;function M(c,e,t){return j.diff(c,e,t)}class y extends I{constructor(){super(...arguments),this.tokenize=A}equals(e,t,n){return n.ignoreWhitespace?((!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim()),(!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(e.endsWith(`
`)&&(e=e.slice(0,-1)),t.endsWith(`
`)&&(t=t.slice(0,-1))),super.equals(e,t,n)}}const z=new y;function W(c,e,t){return z.diff(c,e,t)}function A(c,e){e.stripTrailingCr&&(c=c.replace(/\r\n/g,`
`));const t=[],n=c.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(let o=0;o<n.length;o++){const l=n[o];o%2&&!e.newlineIsToken?t[t.length-1]+=l:t.push(l)}return t}export{M as a,W as d};
